<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Campus Connect - Recursos</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Roboto', sans-serif; background-color: #f5f7fa; color: #333; }

        /* Header */
        header {
            background-color: #e6f2ff; padding: 12px 30px; display: flex; justify-content: space-between;
            align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .logo-container { display: flex; align-items: center; gap: 12px; }
        .logo-icon { font-size: 28px; color: #0d67a5; }
        .logo-text { font-weight: 700; color: #0d67a5; font-size: 1.5rem; }
        .admin-info { display: flex; align-items: center; gap: 10px; font-size: 0.95rem; font-weight: 500; color: #0d67a5; text-decoration: none; }
        .admin-info:hover { color: #005fa3; }
        .admin-info i { font-size: 1.6rem; color: #0d67a5; }
        .admin-info:hover i { color: #005fa3; }

        /* Layout */
        .container { display: flex; }
        aside { width: 250px; background: white; padding: 25px 15px; height: calc(100vh - 68px); box-shadow: 2px 0 8px rgba(0,0,0,0.05); overflow-y: auto; }
        nav ul { list-style: none; }
        nav ul li { margin-bottom: 6px; }
        nav ul li a { display: flex; align-items: center; padding: 11px 14px; color: #444; text-decoration: none; border-radius: 8px; font-weight: 500; font-size: 0.95rem; transition: all 0.2s; }
        nav ul li a i { margin-right: 12px; width: 18px; font-size: 1.1rem; text-align: center; }
        nav ul li a:hover { background-color: #e6f2ff; color: #0d67a5; }
        nav ul li a.active { background-color: #0d67a5; color: white; }

        /* Submen√∫ */
        .submenu { margin-left: 30px; max-height: 0; overflow: hidden; transition: max-height 0.3s ease; }
        .submenu.show { max-height: 300px; }
        .submenu a { padding: 8px 14px; font-size: 0.9rem; color: #555; }
        .submenu a:hover { background-color: #f0f8ff; color: #0d67a5; }
        .submenu a.active { background-color: #0d67a5; color: white; }

        /* Main */
        main { flex: 1; padding: 30px; position: relative; }
        .page-title { font-size: 1.7rem; color: #0d67a5; margin-bottom: 25px; font-weight: 500; }

        /* Grid */
        .resources-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 22px; margin-bottom: 40px; }
        .resource-card { background: #f0f8ff; border-radius: 18px; padding: 22px; text-align: center; box-shadow: 0 4px 12px rgba(0,0,0,0.06); transition: all 0.3s ease; display: flex; flex-direction: column; align-items: center; position: relative; }
        .resource-card:hover { transform: translateY(-6px); box-shadow: 0 10px 24px rgba(0,0,0,0.12); }
        .resource-icon { width: 80px; height: 80px; background: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-bottom: 16px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); overflow: hidden; border: 2px solid rgba(13, 103, 165, 0.1); }
        .resource-icon img { width: 100%; height: 100%; object-fit: contain; padding: 12px; }
        .resource-title { font-size: 1.05rem; font-weight: 600; color: #0d67a5; margin-bottom: 8px; line-height: 1.3; }
        .resource-desc { font-size: 0.88rem; color: #555; margin-bottom: 14px; line-height: 1.4; }
        .resource-btn { background: #0d67a5; color: white; padding: 10px 24px; border-radius: 50px; font-weight: 500; text-decoration: none; display: flex; align-items: center; gap: 8px; font-size: 0.9rem; transition: all 0.3s; box-shadow: 0 3px 8px rgba(13,103,165,0.3); }
        .resource-btn:hover { background: #005fa3; transform: translateY(-2px); box-shadow: 0 5px 12px rgba(13,103,165,0.4); }
        .resource-btn i { font-size: 0.9rem; }

        /* Bot√≥n Eliminar */
        .delete-btn {
            position: absolute; top: 8px; right: 8px; background: rgba(239, 68, 68, 0.9); color: white;
            width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center;
            justify-content: center; font-size: 0.9rem; cursor: pointer; transition: all 0.2s;
            z-index: 10; border: none;
        }
        .delete-btn:hover { background: #dc2626; transform: scale(1.1); }

        /* Bot√≥n flotante */
        .add-more-btn {
            position: fixed; bottom: 30px; right: 30px; background: linear-gradient(135deg, #0d67a5, #005fa3);
            color: white; padding: 14px 28px; border-radius: 50px; font-weight: 600; text-decoration: none;
            box-shadow: 0 6px 16px rgba(13, 103, 165, 0.35); transition: all 0.3s; z-index: 100;
            display: flex; align-items: center; gap: 8px;
        }
        .add-more-btn i { font-size: 1.1rem; }
        .add-more-btn:hover { transform: translateY(-3px); box-shadow: 0 10px 24px rgba(13, 103, 165, 0.45); }

        /* Responsive */
        @media (max-width: 992px) { .resources-grid { grid-template-columns: 1fr 1fr; } }
        @media (max-width: 768px) {
            .container { flex-direction: column; }
            aside { width: 100%; height: auto; padding: 15px; }
            .resources-grid { grid-template-columns: 1fr; }
            .add-more-btn { bottom: 20px; right: 20px; padding: 12px 24px; font-size: 0.9rem; }
            header { padding: 12px 20px; }
            .logo-text { font-size: 1.3rem; }
        }
    </style>
</head>
<body>

    <!-- Header -->
    <header>
        <div class="logo-container">
            <i class="fas fa-project-diagram logo-icon"></i>
            <div class="logo-text">Campus Connect</div>
        </div>
        <a href="perfiladmin.html" class="admin-info">
            <span>Administrador</span>
            <i class="fas fa-user-circle"></i>
        </a>
    </header>

    <!-- Main Container -->
    <div class="container">
        <!-- Sidebar -->
        <aside>
            <nav>
                <ul>
                    <li><a href="estadisticas_admin.html"><i class="fas fa-chart-bar"></i> Estad√≠sticas</a></li>
                    <li><a href="usuarios_admin.html"><i class="fas fa-users"></i> Usuarios</a></li>
                    <li>
                        <a href="#" class="dropdown-toggle"><i class="fas fa-plus-circle"></i> Publicar</a>
                        <div class="submenu show">
                            <a href="noticias_admin.html"><i class="fas fa-newspaper"></i> Noticias</a>
                            <a href="eventos_admin.html"><i class="fas fa-calendar-alt"></i> Eventos</a>
                            <a href="recursos_admin.html" class="active"><i class="fas fa-book"></i> Recursos</a>
                            <a href="oportunidades_admin.html"><i class="fas fa-briefcase"></i> Oportunidades</a>
                        </div>
                    </li>
                </ul>
            </nav>
        </aside>

        <!-- Main Content -->
        <main>
            <h1 class="page-title">Recursos Acad√©micos</h1>
            <div id="recursosGrid" class="resources-grid"></div>
            <a href="a√±aderecursos.html" class="add-more-btn">
                <i class="fas fa-plus"></i> A√±ade m√°s Recursos
            </a>
        </main>
    </div>

    <!-- SCRIPT: ELIMINAR + RECARGAR AUTOM√ÅTICO -->
    <script>
        // Men√∫ desplegable
        document.querySelector('.dropdown-toggle').addEventListener('click', function(e) {
            e.preventDefault();
            this.nextElementSibling.classList.toggle('show');
        });

        // ===== ELIMINAR RECURSO (IGUAL QUE EN NOTICIAS) =====
        function eliminarRecurso(id, card) {
            if (!confirm('¬øEst√°s seguro de eliminar este recurso?')) return;
            
            fetch(`/api/recursos/${id}`, { method: 'DELETE' })
                .then(r => r.json())
                .then(d => {
                    if (d.success) {
                        card.remove();
                        alert('‚úÖ Recurso eliminado exitosamente');
                        
                        // Si no quedan recursos, mostrar mensaje
                        if (!document.querySelector('.resource-card')) {
                            document.getElementById('recursosGrid').innerHTML = 
                                '<p style="grid-column: 1/-1; text-align: center; color: #999; padding: 40px 0; font-style: italic;">üìö No hay recursos publicados a√∫n.</p>';
                        }
                    } else {
                        alert('‚ùå Error: ' + (d.message || 'No se pudo eliminar'));
                    }
                })
                .catch(err => {
                    console.error('Error:', err);
                    alert('‚ùå Error de conexi√≥n con el servidor');
                });
        }

        // ===== CARGAR RECURSOS =====
        function cargarRecursos() {
            fetch('/api/recursos')
                .then(r => {
                    if (!r.ok) throw new Error('Error en el servidor');
                    return r.json();
                })
                .then(recursos => {
                    const grid = document.getElementById('recursosGrid');
                    grid.innerHTML = '';

                    if (!Array.isArray(recursos) || recursos.length === 0) {
                        grid.innerHTML = '<p style="grid-column: 1/-1; text-align: center; color: #999; padding: 40px 0; font-style: italic;">üìö No hay recursos publicados a√∫n.</p>';
                        return;
                    }

                    recursos.forEach(r => {
                        const article = document.createElement('article');
                        article.className = 'resource-card';
                        article.dataset.id = r._id || '';

                        // ===== BOT√ìN ELIMINAR (IGUAL QUE EN NOTICIAS) =====
                        const deleteBtn = document.createElement('button');
                        deleteBtn.className = 'delete-btn';
                        deleteBtn.innerHTML = '<i class="fas fa-trash"></i>';
                        deleteBtn.title = 'Eliminar recurso';
                        deleteBtn.onclick = (e) => {
                            e.stopPropagation();
                            e.preventDefault();
                            eliminarRecurso(r._id, article);
                        };
                        article.appendChild(deleteBtn);

                        // ===== √çCONO =====
                        const iconDiv = document.createElement('div');
                        iconDiv.className = 'resource-icon';
                        const img = document.createElement('img');
                        img.src = r.icono || 'https://via.placeholder.com/80?text=R';
                        img.alt = r.titulo;
                        img.onerror = function() {
                            this.src = 'https://via.placeholder.com/80?text=?';
                        };
                        iconDiv.appendChild(img);
                        article.appendChild(iconDiv);

                        // ===== T√çTULO =====
                        const title = document.createElement('h3');
                        title.className = 'resource-title';
                        title.textContent = r.titulo;
                        article.appendChild(title);

                        // ===== DESCRIPCI√ìN =====
                        const desc = document.createElement('p');
                        desc.className = 'resource-desc';
                        desc.textContent = r.descripcion || 'Sin descripci√≥n';
                        article.appendChild(desc);

                        // ===== BOT√ìN =====
                        const btn = document.createElement('a');
                        btn.className = 'resource-btn';
                        btn.href = r.enlace;
                        btn.target = '_blank';
                        btn.innerHTML = r.tipo === 'video' 
                            ? '<i class="fas fa-play-circle"></i> Ver' 
                            : '<i class="fas fa-download"></i> Descargar';
                        article.appendChild(btn);

                        grid.appendChild(article);
                    });
                })
                .catch(err => {
                    console.error('‚ùå Error al cargar recursos:', err);
                    document.getElementById('recursosGrid').innerHTML = 
                        '<p style="color: #dc2626; grid-column: 1/-1; text-align: center; padding: 40px 0;">‚ö†Ô∏è Error al cargar recursos. Verifica que el servidor est√© activo.</p>';
                });
        }

        // CARGAR AL INICIAR
        cargarRecursos();

        // RECARGAR CADA 15 SEGUNDOS
        setInterval(cargarRecursos, 15000);
    </script>
</body>
</html>